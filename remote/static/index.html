<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Karaoke Remote</title>
<style>
body {
    background: #111;
    color: white;
    font-family: sans-serif;
    text-align: center;
    padding: 20px;
}
h2 {
    font-size: 3rem;
    margin-bottom: 10px;
}
button {
    padding: 15px 30px;
    margin: 10px;
    border-radius: 5px;
    border: none;
    background: #333;
    color: white;
    cursor: pointer;
    font-size: 1.5rem;
}
button:active { background: #555; }

input {
    width: 80%;
    padding: 20px;
    font-size: 1.3rem;
    margin-top: 20px;
    border-radius: 10px;
    border: none;
}
</style>
</head>
<body>

<h2>Karaoke Remote</h2>

<!-- Display username -->
<div id="userDisplay" style="font-size: 2rem; margin-bottom: 20px;"></div>

<!-- Add Song to Queue -->
<div>
    <input id="urlInput" placeholder="Paste YouTube link here..." />
    <button onclick="addSong()">Add to Queue</button>
</div>

<!-- Controls -->
<div style="margin-top: 40px;">
    <button onclick="send('/api/pause')">Pause</button>
    <button onclick="send('/api/skip')">Skip</button>
    <button onclick="send('/api/vocal')">Toggle Vocal</button>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
let username = null;

// -----------------------------
// Ask for name on first visit
// -----------------------------
function requestName() {
    username = localStorage.getItem("karaokeName");

    if (!username) {
        username = prompt("Enter your name for the karaoke queue:");
        if (username && username.trim() !== "") {
            localStorage.setItem("karaokeName", username);
        } else {
            username = "Guest";
        }
    }

    document.getElementById("userDisplay").innerText = "Hello, " + username + "!";
}

requestName();

// -----------------------------
// Buttons -> backend
// -----------------------------
function send(endpoint) {
    fetch(endpoint, { method: 'POST' });
}

// -----------------------------
// Add song to queue
// -----------------------------
async function addSong() {
    const url = document.getElementById("urlInput").value;
    const user = localStorage.getItem("karaokeName") || "Guest";

    if (!url.includes("youtube.com") && !url.includes("youtu.be")) {
        alert("Please paste a valid YouTube link");
        return;
    }

    // Step 1: Fetch video metadata (title + channel)
    let title = "Unknown Title";
    let artist = "Unknown Artist";

    try {
        const oembed = await fetch(
            "https://www.youtube.com/oembed?url=" + encodeURIComponent(url) + "&format=json"
        ).then(r => r.json());

        title = oembed.title || title;
        artist = oembed.author_name || artist;
    } catch (err) {
        console.warn("Could not fetch metadata, using defaults", err);
    }

    // Step 2: Send metadata to your server
    await fetch("/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, user, title, artist })
    });

    alert("Added: " + title);
}

</script>

</body>
</html>
